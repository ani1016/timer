<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Countdown Timer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        color: #333;
        transition: background-color 0.5s, color 0.5s;
      }

      .screen {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      .screen.active {
        display: flex;
      }

      .main-screen h1 {
        margin-bottom: 20px;
      }

      .buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 20px;
      }

      .buttons button,
      .manual-input button,
      .controls button {
        padding: 12px 20px;
        font-size: 16px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .buttons button:hover,
      .manual-input button:hover,
      .controls button:hover {
        background-color: #0056b3;
      }

      .manual-input {
        margin-bottom: 20px;
        text-align: center;
      }

      .manual-input input {
        padding: 5px;
        font-size: 16px;
        width: 70px;
        margin: 0 5px;
      }

      .timer {
        font-size: 120px;
        font-weight: bold;
        text-align: center;
        color: white;
      }

      .dark {
        background: black;
        color: white;
      }

      .controls {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }

      .hidden {
        display: none;
      }

      #timerScreen {
        background: black;
        color: white;
      }

      #timerScreen .timer {
        font-size: 140px;
      }

      #backBtn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: transparent;
        border: 2px solid white;
        color: white;
        padding: 10px 15px;
        font-size: 16px;
      }

      .last-timer-info {
        margin-top: 15px;
        font-size: 18px;
        text-align: center;
        color: #444;
      }

      .last-timer-info button {
        margin-top: 10px;
        background-color: #28a745;
      }

      .last-timer-info button:hover {
        background-color: #1e7e34;
      }

      .clear-btn {
        background-color: #dc3545 !important;
      }

      .clear-btn:hover {
        background-color: #b52a37 !important;
      }
    </style>
  </head>
  <body>
    <!-- MAIN SCREEN -->
    <div id="mainScreen" class="screen active main-screen">
      <h1>Select Countdown Time</h1>

      <div class="buttons">
        <button data-seconds="900">15 Minutes</button>
        <button data-seconds="1800">30 Minutes</button>
        <button data-seconds="2700">45 Minutes</button>
        <button data-seconds="3600">1 Hour</button>
        <button data-seconds="7200">2 Hours</button>
        <button data-seconds="10800">3 Hours</button>
        <button data-seconds="14400">4 Hours</button>
        <button data-seconds="18000">5 Hours</button>
        <button data-seconds="21600">6 Hours</button>
        <button data-seconds="25200">7 Hours</button>
      </div>

      <div class="manual-input">
        <label
          >Hours: <input type="number" id="hoursInput" min="0" value="0"
        /></label>
        <label
          >Minutes:
          <input type="number" id="minutesInput" min="0" max="59" value="0"
        /></label>
        <label
          >Seconds:
          <input type="number" id="secondsInput" min="0" max="59" value="0"
        /></label>
        <button id="startCustom">Start Custom</button>
      </div>

      <div class="controls">
        <button id="toggleSoundBtn">üîä Sound: On</button>
        <button id="toggleThemeBtn">üåì Toggle Theme</button>
        <label>
          Volume:
          <input
            type="range"
            id="volumeControl"
            min="0"
            max="1"
            step="0.01"
            value="1"
          />
        </label>
      </div>

      <div id="lastTimerInfo" class="last-timer-info"></div>
    </div>

    <!-- TIMER SCREEN -->
    <div id="timerScreen" class="screen dark">
      <button id="backBtn">‚Üê Back</button>
      <div id="countdown" class="timer">00:00:00</div>
      <div class="controls">
        <button id="pauseBtn" class="hidden">‚è∏ Pause</button>
        <button id="resumeBtn" class="hidden">‚ñ∂Ô∏è Resume</button>
      </div>
    </div>

    <!-- AUDIO -->
    <audio id="tickSound" src="ticking-clock-182894.mp3" loop></audio>
    <audio id="alarmSound" src="alarm.mp3"></audio>

    <script>
      const buttons = document.querySelectorAll(".buttons button");
      const countdownEl = document.getElementById("countdown");
      const tickSound = document.getElementById("tickSound");
      const alarmSound = document.getElementById("alarmSound");
      const toggleSoundBtn = document.getElementById("toggleSoundBtn");
      const toggleThemeBtn = document.getElementById("toggleThemeBtn");
      const volumeControl = document.getElementById("volumeControl");

      const pauseBtn = document.getElementById("pauseBtn");
      const resumeBtn = document.getElementById("resumeBtn");
      const startCustomBtn = document.getElementById("startCustom");
      const backBtn = document.getElementById("backBtn");

      const hoursInput = document.getElementById("hoursInput");
      const minutesInput = document.getElementById("minutesInput");
      const secondsInput = document.getElementById("secondsInput");

      const mainScreen = document.getElementById("mainScreen");
      const timerScreen = document.getElementById("timerScreen");
      const lastTimerInfo = document.getElementById("lastTimerInfo");

      let timerInterval = null;
      let endTime = null;
      let paused = false;
      let remainingTime = 0;
      let soundEnabled = true;
      let wakeLock = null;

      function formatTime(seconds) {
        const hrs = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;

        return `${hrs.toString().padStart(2, "0")}:${mins
          .toString()
          .padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
      }

      async function requestWakeLock() {
        try {
          wakeLock = await navigator.wakeLock.request("screen");
          wakeLock.addEventListener("release", () =>
            console.log("Wake Lock released")
          );
        } catch (err) {
          console.error("Wake Lock error:", err);
        }
      }

      function releaseWakeLock() {
        if (wakeLock) {
          wakeLock.release().then(() => (wakeLock = null));
        }
      }

      function startCountdown(seconds) {
        localStorage.setItem("lastTimerSeconds", seconds); // Save to memory

        if (timerInterval) clearInterval(timerInterval);
        endTime = Date.now() + seconds * 1000;
        remainingTime = seconds;
        paused = false;

        showScreen(timerScreen);
        showPause();
        updateDisplay();

        if (soundEnabled) {
          tickSound.currentTime = 0;
          tickSound.play().catch(() => {});
        }

        requestWakeLock();

        timerInterval = setInterval(() => {
          if (!paused) {
            const now = Date.now();
            const remaining = Math.max(0, Math.floor((endTime - now) / 1000));
            remainingTime = remaining;
            updateDisplay();

            if (remaining <= 0) {
              clearInterval(timerInterval);
              countdownEl.textContent = "Time's up!";
              tickSound.pause();
              tickSound.currentTime = 0;
              alarmSound.currentTime = 0;
              alarmSound.play().catch(() => {});
              releaseWakeLock();
              hidePauseResume();
            }
          }
        }, 1000);
      }

      function updateDisplay() {
        countdownEl.textContent = formatTime(remainingTime);
      }

      function showPause() {
        pauseBtn.classList.remove("hidden");
        resumeBtn.classList.add("hidden");
      }

      function showResume() {
        pauseBtn.classList.add("hidden");
        resumeBtn.classList.remove("hidden");
      }

      function hidePauseResume() {
        pauseBtn.classList.add("hidden");
        resumeBtn.classList.add("hidden");
      }

      function showScreen(screen) {
        mainScreen.classList.remove("active");
        timerScreen.classList.remove("active");
        screen.classList.add("active");
      }

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const seconds = parseInt(btn.dataset.seconds);
          startCountdown(seconds);
        });
      });

      startCustomBtn.addEventListener("click", () => {
        const h = parseInt(hoursInput.value) || 0;
        const m = parseInt(minutesInput.value) || 0;
        const s = parseInt(secondsInput.value) || 0;
        const total = h * 3600 + m * 60 + s;
        if (total > 0) startCountdown(total);
      });

      pauseBtn.addEventListener("click", () => {
        paused = true;
        showResume();
        tickSound.pause();
        releaseWakeLock();
      });

      resumeBtn.addEventListener("click", () => {
        if (paused) {
          paused = false;
          endTime = Date.now() + remainingTime * 1000;
          showPause();
          if (soundEnabled) tickSound.play().catch(() => {});
          requestWakeLock();
        }
      });

      toggleSoundBtn.addEventListener("click", () => {
        soundEnabled = !soundEnabled;
        toggleSoundBtn.textContent = soundEnabled
          ? "üîä Sound: On"
          : "üîá Sound: Off";
        if (!soundEnabled) tickSound.pause();
        else if (!paused && remainingTime > 0) tickSound.play().catch(() => {});
      });

      toggleThemeBtn.addEventListener("click", () => {
        document.body.classList.toggle("dark");
      });

      backBtn.addEventListener("click", () => {
        clearInterval(timerInterval);
        tickSound.pause();
        releaseWakeLock();
        hidePauseResume();
        showScreen(mainScreen);
      });

      document.addEventListener("visibilitychange", () => {
        if (wakeLock !== null && document.visibilityState === "visible") {
          requestWakeLock();
        }
      });

      volumeControl.addEventListener("input", () => {
        tickSound.volume = volumeControl.value;
        alarmSound.volume = volumeControl.value;
      });

      tickSound.volume = volumeControl.value;
      alarmSound.volume = volumeControl.value;

      // Show last timer info
      window.addEventListener("DOMContentLoaded", () => {
        const last = localStorage.getItem("lastTimerSeconds");
        if (last) {
          const seconds = parseInt(last);
          const hrs = Math.floor(seconds / 3600);
          const mins = Math.floor((seconds % 3600) / 60);
          const secs = seconds % 60;

          lastTimerInfo.innerHTML = `
          <div>üß† Last timer used: <strong>${hrs}h ${mins}m ${secs}s</strong></div>
          <button onclick="startCountdown(${seconds})">Repeat Last Timer</button>
          <button class="clear-btn" onclick="localStorage.removeItem('lastTimerSeconds'); location.reload()">Clear Memory</button>
        `;
        }
      });
    </script>
  </body>
</html>
